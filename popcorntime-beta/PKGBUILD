# Maintainer: Ricardo Band <me@xengi.de>

pkgname=popcorntime-beta
pkgver=2.5
_archivename=popcorn-app-beta_2_5
pkgrel=4
pkgdesc="Stream movies from torrents. Skip the downloads. Launch, click, watch."
arch=('x86_64')
url="http://getpopcornti.me/"
license=('custom')
provides=("popcorntime")
options=('!strip')
source=("https://github.com/popcorn-time/popcorn-app/archive/beta_2_5.tar.gz"
        "TOS.txt")
md5sums=('471cc8026809622ed1e8c621c3dbaad1'
         '1e6df124be80e43f3f819b832560432e')

build() {
  cd "${srcdir}/${_archivename}/dist/linux"
  sed -i '$ d' build.sh
  sh build.sh
}

package() {
  cd "${srcdir}/${_archivename}/dist/linux/PopcornTime"

  # Program
  local _OPT="/opt/popcorn-time"
  mkdir -p "${pkgdir}${_OPT}"
  install -m755 popcorn-app.run "${pkgdir}${_OPT}/"
  install -m744 nw.pak "${pkgdir}${_OPT}/"
  install -m755 libffmpegsumo.so "${pkgdir}${_OPT}/"

  # Link to program
  mkdir -p "${pkgdir}/usr/bin"
  ln -s "${_OPT}/popcorn-app.run" "${pkgdir}/usr/bin/${provides[0]}"

  # Desktop file
  install -Dm644 "${srcdir}/popcorntime.desktop" "${pkgdir}/usr/share/applications/popcorntime.desktop"

  # Icon
  install -Dm644 "${srcdir}/popcorntime_16x16.png" "${pkgdir}/usr/share/icons/hicolor/16x16/apps/popcorntime.png"
  install -Dm644 "${srcdir}/popcorntime_32x32.png" "${pkgdir}/usr/share/icons/hicolor/32x32/apps/popcorntime.png"
  install -Dm644 "${srcdir}/popcorntime_48x48.png" "${pkgdir}/usr/share/icons/hicolor/48x48/apps/popcorntime.png"
  install -Dm644 "${srcdir}/popcorntime_64x64.png" "${pkgdir}/usr/share/icons/hicolor/64x64/apps/popcorntime.png"
  install -Dm644 "${srcdir}/popcorntime_128x128.png" "${pkgdir}/usr/share/icons/hicolor/128x128/apps/popcorntime.png"
  install -Dm644 "${srcdir}/popcorntime_256x256.png" "${pkgdir}/usr/share/icons/hicolor/256x256/apps/popcorntime.png"

  # License
  install -Dm644 "${srcdir}/TOS.txt" "${pkgdir}/usr/share/licenses/${pkgname}/LICENSE"
}
